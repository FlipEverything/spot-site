<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="author" content="Vance Lucas"><meta name="keywords"><meta name="description"><title>Working With Entities &ndash; Spot ORM</title><link href="/favicon.png" rel="icon"><link rel="alternate" href="/atom.xml" title="config.title" type="application/atom.xml"><link rel="stylesheet" href="/stylesheets/main.css"><link rel="stylesheet" href="/stylesheets/font-awesome.min.css"></head><body><nav id="topnav" role="navigation" class="navbar navbar-default"><div class="container"><a href="/" class="navbar-brand"><i class="fa fa-database"></i> Spot ORM</a><ul class="nav navbar-nav navbar-right pad-right"><li><a href="/">Home</a></li><li><a href="/docs">Documentation</a></li><li><a href="/articles">Articles</a></li></ul></div></nav><div class="container"><div class="row"><div class="col-md-2 col-lg-2"><div class="sidenav"><ul class="nav"><li><div class="nav-title">Setup</div><ul class="nav submenu"><li><a href="/docs/installation" title="Installation" class="link">Installation</a></li><li><a href="/docs/database-setup" title="Database Setup" class="link">Database Setup</a></li></ul></li><li><div class="nav-title">Basics</div><ul class="nav submenu"><li><a href="/docs/mappers" title="Mappers" class="link">Mappers</a></li><li><a href="/docs/entities" title="Entities" class="link active">Entities</a></li><li><a href="/docs/types" title="Field Types" class="link">Field Types</a></li><li><a href="/docs/migrations" title="Migrations" class="link">Migrations</a></li><li><a href="/docs/crud" title="Basic CRUD" class="link">Basic CRUD</a></li><li><a href="/docs/queries" title="Queries" class="link">Queries</a></li><li><a href="/docs/relations" title="Relations" class="link">Relations</a></li><li><a href="/docs/events" title="Events" class="link">Events</a></li></ul></li><li><div class="nav-title">Advanced</div><ul class="nav submenu"><li><a href="/docs/scopes" title="Scopes" class="link">Scopes</a></li><li><a href="/docs/complex-queries" title="Complex Queries" class="link">Complex Queries</a></li></ul></li></ul></div></div><div class="col-md-10 col-lg-10"><section id="page_content"><article><div class="toc-wrap"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Defining_An_Entity"><span class="toc-number">1.</span> <span class="toc-text">Defining An Entity</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#undefined"><span class="toc-number">1.0.1.</span> <span class="toc-text">Field Options</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Primary_Keys"><span class="toc-number">1.1.</span> <span class="toc-text">Primary Keys</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Indexes"><span class="toc-number">1.2.</span> <span class="toc-text">Indexes</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Unique_Columns"><span class="toc-number">1.3.</span> <span class="toc-text">Unique Columns</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Required_Fields"><span class="toc-number">1.4.</span> <span class="toc-text">Required Fields</span></a></li></ol></li></ol></div><h1>Working With Entities<div class="docs-edit"><a href="https://github.com/vlucas/spot-site/blob/master/source/docs/entities/index.md" title="Improve this Documentation"><i class="fa fa-pencil"></i> edit</a></div></h1><p>Entity classes can be named and namespaced however you want to set them
up within your project structure. For the following examples, the
Entities will just be prefixed with an <code>Entity</code> namespace for easy psr-0
compliant autoloading.</p>
<h2 id="Defining_An_Entity">Defining An Entity</h2>
<p>The minimal required definition of an entity defines the <code>$table</code> and the <code>fields</code>, and extends from <code>Spot\Entity</code>:</p>
<figure class="highlight php"><pre><div class="line"><span class="preprocessor">&lt;?php</span></div><div class="line"><span class="keyword">namespace</span> <span class="title">Entity</span>;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Post</span> <span class="keyword">extends</span> \<span class="title">Spot</span>\<span class="title">Entity</span></span></div><div class="line">{</div><div class="line">    <span class="keyword">protected</span> <span class="keyword">static</span> <span class="variable">$table</span> = <span class="string">'posts'</span>;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="function"><span class="keyword">function</span> <span class="title">fields</span><span class="params">()</span></span></div><div class="line">    {</div><div class="line">        <span class="keyword">return</span> [</div><div class="line">            <span class="string">'id'</span>           =&gt; [<span class="string">'type'</span> =&gt; <span class="string">'integer'</span>, <span class="string">'primary'</span> =&gt; <span class="keyword">true</span>, <span class="string">'autoincrement'</span> =&gt; <span class="keyword">true</span>],</div><div class="line">            <span class="string">'title'</span>        =&gt; [<span class="string">'type'</span> =&gt; <span class="string">'string'</span>, <span class="string">'required'</span> =&gt; <span class="keyword">true</span>],</div><div class="line">            <span class="string">'body'</span>         =&gt; [<span class="string">'type'</span> =&gt; <span class="string">'text'</span>, <span class="string">'required'</span> =&gt; <span class="keyword">true</span>],</div><div class="line">            <span class="string">'status'</span>       =&gt; [<span class="string">'type'</span> =&gt; <span class="string">'integer'</span>, <span class="string">'default'</span> =&gt; <span class="number">0</span>, <span class="string">'index'</span> =&gt; <span class="keyword">true</span>],</div><div class="line">            <span class="string">'author_id'</span>    =&gt; [<span class="string">'type'</span> =&gt; <span class="string">'integer'</span>, <span class="string">'required'</span> =&gt; <span class="keyword">true</span>],</div><div class="line">            <span class="string">'date_created'</span> =&gt; [<span class="string">'type'</span> =&gt; <span class="string">'datetime'</span>, <span class="string">'value'</span> =&gt; <span class="keyword">new</span> \DateTime()]</div><div class="line">        ];</div><div class="line">    }</div><div class="line">}</div></pre></figure>

<div class="callout info">
  <h4>Field Options</h4>

  <p>All of the <strong><a href="http://docs.doctrine-project.org/projects/doctrine-dbal/en/latest/reference/schema-representation.html#column" target="_blank" rel="external">DBAL
  schema column options</a></strong> can be used for field attributes, and will be passed to DBAL when
  creating the table structure through <a href="/docs/migrations/">migrations</a>. Spot adds some additional field attributes like <code>required</code> and <code>value</code> as well.</p>
</div>

<h3 id="Primary_Keys">Primary Keys</h3>
<p>In the above “Post” entity, the primary key is defined on the <code>id</code> field
with a <code>&#39;primary&#39; =&gt; true</code> attribute on the field definition. If the primary
key is also an auto-increment column, you must also add a <code>&#39;autoincrement&#39; =&gt;
true</code> attribute.</p>
<p>The full required definition looks like this:</p>
<figure class="highlight php"><pre><div class="line"><span class="string">'id'</span> =&gt; [<span class="string">'type'</span> =&gt; <span class="string">'integer'</span>, <span class="string">'primary'</span> =&gt; <span class="keyword">true</span>, <span class="string">'autoincrement'</span> =&gt; <span class="keyword">true</span>]</div></pre></figure>

<h3 id="Indexes">Indexes</h3>
<p>An index can be defined on an entity field by adding the <code>&#39;index&#39; =&gt; true</code>
attribute.</p>
<figure class="highlight php"><pre><div class="line"><span class="string">'status'</span> =&gt; [<span class="string">'type'</span> =&gt; <span class="string">'integer'</span>, <span class="string">'index'</span> =&gt; <span class="keyword">true</span>]</div></pre></figure>

<p>Many times, it is desirable to create a <strong>compound index</strong> with more than one
column. In Spot, simply give the <code>index</code> attribute a name that is shared with
another column, and a compound index will be created using all columns with the
same index name.</p>
<figure class="highlight php"><pre><div class="line"><span class="string">'lat'</span> =&gt; [<span class="string">'type'</span> =&gt; <span class="string">'decimal'</span>, <span class="string">'index'</span> =&gt; <span class="string">'geolocation'</span>]</div><div class="line"><span class="string">'lng'</span> =&gt; [<span class="string">'type'</span> =&gt; <span class="string">'decimal'</span>, <span class="string">'index'</span> =&gt; <span class="string">'geolocation'</span>]</div></pre></figure>

<h3 id="Unique_Columns">Unique Columns</h3>
<p>Similar to defining an index, you must add a <code>&#39;unique&#39; =&gt; true</code> to specify a
single field as requiring a unique value:</p>
<figure class="highlight php"><pre><div class="line"><span class="string">'email'</span> =&gt; [<span class="string">'type'</span> =&gt; <span class="string">'string'</span>, <span class="string">'required'</span> =&gt; <span class="keyword">true</span>, <span class="string">'unique'</span> =&gt; <span class="keyword">true</span>]</div></pre></figure>

<p>And also just like normal indexes, <strong>compound unique indexes</strong> can be created
by using a shared name:</p>
<figure class="highlight php"><pre><div class="line"><span class="string">'email'</span>    =&gt; [<span class="string">'type'</span> =&gt; <span class="string">'string'</span>, <span class="string">'required'</span> =&gt; <span class="keyword">true</span>, <span class="string">'unique'</span> =&gt; <span class="string">'user_email'</span>]</div><div class="line"><span class="string">'username'</span> =&gt; [<span class="string">'type'</span> =&gt; <span class="string">'string'</span>, <span class="string">'required'</span> =&gt; <span class="keyword">true</span>, <span class="string">'unique'</span> =&gt; <span class="string">'user_email'</span>]</div></pre></figure>

<div class="callout info">
  To detect duplicate values and return a friendly error message instead of an
  exception from the database engine, Spot will automatically attempt to find
  existing entities with duplicate values you are passing when a field is marked
  as <code>unique</code>. This happens in the <code>validate</code> method of <code>Spot\Mapper</code> that is
  run before every insert and update operation. This results in <em>one extra query
  on insert or update</em> for each unique column or compound column group.
</div>

<h3 id="Required_Fields">Required Fields</h3>
<p>A required field can be enforced on save, create, and update using a
<code>&#39;required&#39; =&gt; true</code> attribute.</p>
<figure class="highlight php"><pre><div class="line"><span class="string">'email'</span> =&gt; [<span class="string">'type'</span> =&gt; <span class="string">'string'</span>, <span class="string">'required'</span> =&gt; <span class="keyword">true</span>]</div></pre></figure>

</article></section></div></div></div><div class="container"><footer id="page_foot"><div class="row"><div class="col-md-8 col-lg-8"><p class="text-muted">Using Spot in an awesome project? <a href="http://twitter.com/vlucas">Let me know</a>!</p><p class="text-muted"><a href="https://github.com/vlucas/spot2"><i class="fa fa-github"></i> View Code on GitHub</a> &mdash; Open source under the <a href="http://www.opensource.org/licenses/bsd-license.php">BSD license</a>.</p></p></div><div class="col-md-4 col-lg-4"><p class="text-muted text-right">Website built with&nbsp;<a href="http://hexo.io/">hexo</a></p></div><script type="text/javascript">(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-359731-14', 'phpdatamapper.com');
ga('send', 'pageview');</script></div></footer></div></body></html>