<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="author" content="Vance Lucas"><meta name="description"><title>Queries With Spot&mdash;Spot ORM</title><link href="/favicon.png" rel="icon"><link rel="alternate" href="/atom.xml" title="config.title" type="application/atom.xml"><link rel="stylesheet" href="/stylesheets/main.css"><link rel="stylesheet" href="/stylesheets/font-awesome.min.css"></head><body><nav id="topnav" role="navigation" class="navbar navbar-default"><div class="container"><a href="/" class="navbar-brand"><i class="fa fa-database"></i> Spot ORM</a><ul class="nav navbar-nav navbar-right pad-right"><li><a href="/">Home</a></li><li><a href="/docs">Documentation</a></li><li><a href="/articles">Articles</a></li></ul></div></nav><div class="container"><div class="row"><div class="col-md-2 col-lg-2"><div class="sidenav"><ul class="nav"><li><div class="nav-title">Setup</div><ul class="nav submenu"><li><a href="/docs/installation" title="Installation" class="link">Installation</a></li><li><a href="/docs/database-setup" title="Database Setup" class="link">Database Setup</a></li></ul></li><li><div class="nav-title">Basics</div><ul class="nav submenu"><li><a href="/docs/mappers" title="Mappers" class="link">Mappers</a></li><li><a href="/docs/entities" title="Entities" class="link">Entities</a></li><li><a href="/docs/types" title="Field Types" class="link">Field Types</a></li><li><a href="/docs/migrations" title="Migrations" class="link">Migrations</a></li><li><a href="/docs/queries" title="Queries" class="link active">Queries</a></li><li><a href="/docs/relations" title="Relations" class="link">Relations</a></li><li><a href="/docs/events" title="Events" class="link">Events</a></li></ul></li></ul></div></div><div class="col-md-10 col-lg-10"><section id="page_content"><article><div class="pull-right"><a href="https://github.com/vlucas/spot-site/blob/master/source/docs/queries/index.md" title="Improve this Documentation"><i class="fa fa-pencil"></i> edit</a></div><h1>Queries With Spot</h1><h2 id="Finders_(Mapper)">Finders (Mapper)</h2>
<p>All these finders require a <a href="/docs/mappers/">Mapper</a> instance. Mappers
are responsible for finding and updating individual entities.</p>
<p>The main finders used most are <code>all</code> to return a collection of entities,
and <code>first</code> or <code>get</code> to return a single entity matching the conditions.</p>
<h3 id="all()">all()</h3>
<p>Find all entities and return a <code>Spot\Entity\Collection</code> of loaded <code>Entity\Post</code>
objects.</p>
<figure class="highlight php"><pre><span class="comment">// Get ALL posts</span>
<span class="variable">$mapper</span> = <span class="variable">$spot</span>-&gt;mapper(<span class="string">'Entity\Post'</span>);
<span class="variable">$posts</span> = <span class="variable">$mapper</span>-&gt;all();
</pre></figure>

<h3 id="where([conditions])">where([conditions])</h3>
<p>Find all entities that match the given conditions and return a
<code>Spot\Entity\Collection</code> of loaded <code>Entity\Post</code> objects.</p>
<figure class="highlight php"><pre><span class="variable">$mapper</span> = <span class="variable">$spot</span>-&gt;mapper(<span class="string">'Entity\Post'</span>);

<span class="comment">// Where can be called directly from the mapper</span>
<span class="variable">$posts</span> = <span class="variable">$mapper</span>-&gt;where([<span class="string">'status'</span> =&gt; <span class="number">1</span>]);

<span class="comment">// Or chained using the returned `Spot\Query` object - results identical to above</span>
<span class="variable">$posts</span> = <span class="variable">$mapper</span>-&gt;all()-&gt;where([<span class="string">'status'</span> =&gt; <span class="number">1</span>]);

<span class="comment">// Or more explicitly using using `select`, which always returns a `Spot\Query` object</span>
<span class="variable">$posts</span> = <span class="variable">$mapper</span>-&gt;select()-&gt;where([<span class="string">'status'</span> =&gt; <span class="number">1</span>]);
</pre></figure>

<p>Since a <code>Spot\Query</code> object is returned, conditions and other statements
can be chained in any way or order you want. The query will be
lazy-executed on interation or <code>count</code>, or manually by ending the chain with a
call to <code>execute()</code>.</p>
<h4 id="Conditional_Variations">Conditional Variations</h4>
<figure class="highlight php"><pre><span class="comment"># All posts with a 'published' status, descending by date_created</span>
<span class="variable">$posts</span> = <span class="variable">$mapper</span>-&gt;all()
    -&gt;where([<span class="string">'status'</span> =&gt; <span class="string">'published'</span>])
    -&gt;order([<span class="string">'date_created'</span> =&gt; <span class="string">'DESC'</span>]);

<span class="comment"># All posts created before 3 days ago</span>
<span class="variable">$posts</span> = <span class="variable">$mapper</span>-&gt;all()
    -&gt;where([<span class="string">'date_created &lt;'</span> =&gt; <span class="keyword">new</span> \DateTime(<span class="string">'-3 days'</span>)]);

<span class="comment"># Posts with 'id' of 1, 2, 5, 12, or 15 - Array value = automatic "IN" clause</span>
<span class="variable">$posts</span> = <span class="variable">$mapper</span>-&gt;all()
    -&gt;where([<span class="string">'id'</span> =&gt; [<span class="number">1</span>, <span class="number">2</span>, <span class="number">5</span>, <span class="number">12</span>, <span class="number">15</span>]]);
</pre></figure>

<h3 id="first([conditions])">first([conditions])</h3>
<p>Find and return a single <code>Spot\Entity</code> object that matches the criteria.</p>
<figure class="highlight php"><pre><span class="variable">$post</span> = <span class="variable">$mapper</span>-&gt;first([<span class="string">'title'</span> =&gt; <span class="string">"Test Post"</span>]);
</pre></figure>

<p>Or <code>first</code> can be used on a previous query with <code>where</code> to fetch only the first
matching record.</p>
<figure class="highlight php"><pre><span class="variable">$post</span> = <span class="variable">$mapper</span>-&gt;where([<span class="string">'title'</span> =&gt; <span class="string">"Test Post"</span>])-&gt;first();
</pre></figure>

<p>A call to <code>first</code> will always execute the query immediately, and return either
a single loaded entity object, or boolean <code>false</code>.</p>
<h3 id="Joins">Joins</h3>
<p>Joins are currently not enabled by Spot’s query builder. The Doctine DBAL query
builder does provide full support for them, so they may be enabled in the
future.</p>
<h3 id="Custom_Queries">Custom Queries</h3>
<p>While ORMs like Spot are very nice to use, if you need to do complex queries,
it’s best to just use custom queries with the SQL you know and love.</p>
<p>Spot provides a <code>query</code> method that allows you to run custom SQL, and load the
results into a normal collection of entity objects. This way, you can easily run
custom SQL queries with all the same ease of use and convenience as the
built-in finder methods and you won’t have to do any special handling.</p>
<h4 id="Using_Custom_SQL">Using Custom SQL</h4>
<figure class="highlight php"><pre><span class="variable">$posts</span> = <span class="variable">$mapper</span>-&gt;query(<span class="string">"SELECT * FROM posts WHERE id = 1"</span>);
</pre></figure>

<h4 id="Using_Query_Parameters">Using Query Parameters</h4>
<figure class="highlight php"><pre><span class="variable">$posts</span> = <span class="variable">$mapper</span>-&gt;query(<span class="string">"SELECT * FROM posts WHERE id = ?"</span>, [<span class="number">1</span>]);
</pre></figure>

<h4 id="Using_Named_Placeholders">Using Named Placeholders</h4>
<figure class="highlight php"><pre><span class="variable">$posts</span> = <span class="variable">$mapper</span>-&gt;query(<span class="string">"SELECT * FROM posts WHERE id = :id"</span>, [<span class="string">'id'</span> =&gt; <span class="number">1</span>]);
</pre></figure>

<div class="callout info">
  Spot will load ALL returned columns on the target entity from the query
  you run. So if you perform a JOIN or get more data than the target entity
  normally has, it will just be loaded on the target entity, and no attempt will
  be made to map the data to other entities or to filter it based on only the
  defined fields.
</div>

</article></section></div></div></div><div class="container"><footer id="page_foot"><div class="row"><div class="col-md-8 col-lg-8"><p class="text-muted">Using Spot in an awesome project? <a href="http://twitter.com/vlucas">Let me know</a>!</p><p class="text-muted">Open source under the <a href="http://www.opensource.org/licenses/bsd-license.php">BSD license</a>.</p></p></div><div class="col-md-4 col-lg-4"><p class="text-muted text-right">Website built with&nbsp;<a href="http://hexo.io/">hexo</a></p></div><script type="text/javascript">(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-359731-14', 'phpdatamapper.com');
ga('send', 'pageview');</script></div></footer></div></body></html>