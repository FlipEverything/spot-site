<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="author" content="Vance Lucas"><meta name="keywords"><meta name="description"><title>Queries With Spot &ndash; Spot ORM</title><link href="/favicon.png" rel="icon"><link rel="alternate" href="/atom.xml" title="config.title" type="application/atom.xml"><link rel="stylesheet" href="/stylesheets/main.css"><link rel="stylesheet" href="/stylesheets/font-awesome.min.css"></head><body><nav id="topnav" role="navigation" class="navbar navbar-default"><div class="container"><a href="/" class="navbar-brand"><i class="fa fa-database"></i> Spot ORM</a><ul class="nav navbar-nav navbar-right pad-right"><li><a href="/">Home</a></li><li><a href="/docs">Documentation</a></li><li><a href="/articles">Articles</a></li></ul></div></nav><div class="container"><div class="row"><div class="col-md-2 col-lg-2"><div class="sidenav"><ul class="nav"><li><div class="nav-title">Setup</div><ul class="nav submenu"><li><a href="/docs/installation" title="Installation" class="link">Installation</a></li><li><a href="/docs/database-setup" title="Database Setup" class="link">Database Setup</a></li></ul></li><li><div class="nav-title">Basics</div><ul class="nav submenu"><li><a href="/docs/mappers" title="Mappers" class="link">Mappers</a></li><li><a href="/docs/entities" title="Entities" class="link">Entities</a></li><li><a href="/docs/types" title="Field Types" class="link">Field Types</a></li><li><a href="/docs/migrations" title="Migrations" class="link">Migrations</a></li><li><a href="/docs/crud" title="Basic CRUD" class="link">Basic CRUD</a></li><li><a href="/docs/queries" title="Queries" class="link active">Queries</a></li><li><a href="/docs/relations" title="Relations" class="link">Relations</a></li><li><a href="/docs/events" title="Events" class="link">Events</a></li></ul></li><li><div class="nav-title">Advanced</div><ul class="nav submenu"><li><a href="/docs/scopes" title="Scopes" class="link">Scopes</a></li><li><a href="/docs/complex-queries" title="Complex Queries" class="link">Complex Queries</a></li></ul></li></ul></div></div><div class="col-md-10 col-lg-10"><section id="page_content"><article><div class="toc-wrap"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Finders_(Mapper)"><span class="toc-number">1.</span> <span class="toc-text">Finders (Mapper)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#get([$primaryKey])"><span class="toc-number">1.1.</span> <span class="toc-text">get([$primaryKey])</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#all()"><span class="toc-number">1.2.</span> <span class="toc-text">all()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#where([conditions])"><span class="toc-number">1.3.</span> <span class="toc-text">where([conditions])</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Conditional_Variations"><span class="toc-number">1.3.1.</span> <span class="toc-text">Conditional Variations</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#first([conditions])"><span class="toc-number">1.4.</span> <span class="toc-text">first([conditions])</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#select()"><span class="toc-number">1.5.</span> <span class="toc-text">select()</span></a></li></ol></li></ol></div><h1>Queries With Spot<div class="docs-edit"><a href="https://github.com/vlucas/spot-site/blob/master/source/docs/queries/index.md" title="Improve this Documentation"><i class="fa fa-pencil"></i> edit</a></div></h1><h2 id="Finders_(Mapper)">Finders (Mapper)</h2>
<p>All these finders require a <a href="/docs/mappers/">Mapper</a> instance. Mappers
are responsible for finding and updating individual entities.</p>
<p>The main finders used most are <code>all</code> to return a collection of entities,
and <code>first</code> or <code>get</code> to return a single entity matching the conditions.</p>
<h3 id="get([$primaryKey])">get([$primaryKey])</h3>
<p>The <code>get</code> method accepts a primary key to load a record with:</p>
<figure class="highlight php"><pre><div class="line"><span class="comment">// Get Post with 'id' = 58</span></div><div class="line"><span class="variable">$mapper</span> = <span class="variable">$spot</span><span class="variable">-&gt;mapper</span>(<span class="string">'Entity\Post'</span>);</div><div class="line"><span class="variable">$post</span> = <span class="variable">$mapper</span><span class="variable">-&gt;get</span>(<span class="number">58</span>);</div></pre></figure>

<p>If there is no <code>Entity\Post</code> with the primary key provided, boolean <code>false</code>
will be returned.</p>
<h3 id="all()">all()</h3>
<p>Find all entities and return a <code>Spot\Entity\Collection</code> of loaded <code>Entity\Post</code>
objects.</p>
<figure class="highlight php"><pre><div class="line"><span class="comment">// Get ALL posts</span></div><div class="line"><span class="variable">$mapper</span> = <span class="variable">$spot</span><span class="variable">-&gt;mapper</span>(<span class="string">'Entity\Post'</span>);</div><div class="line"><span class="variable">$posts</span> = <span class="variable">$mapper</span><span class="variable">-&gt;all</span>();</div></pre></figure>

<h3 id="where([conditions])">where([conditions])</h3>
<p>Find all entities that match the given conditions and return a
<code>Spot\Entity\Collection</code> of loaded <code>Entity\Post</code> objects.</p>
<figure class="highlight php"><pre><div class="line"><span class="variable">$mapper</span> = <span class="variable">$spot</span><span class="variable">-&gt;mapper</span>(<span class="string">'Entity\Post'</span>);</div><div class="line"></div><div class="line"><span class="comment">// Where can be called directly from the mapper</span></div><div class="line"><span class="variable">$posts</span> = <span class="variable">$mapper</span><span class="variable">-&gt;where</span>([<span class="string">'status'</span> =&gt; <span class="number">1</span>]);</div><div class="line"></div><div class="line"><span class="comment">// Or chained using the returned `Spot\Query` object - results identical to above</span></div><div class="line"><span class="variable">$posts</span> = <span class="variable">$mapper</span><span class="variable">-&gt;all</span>()<span class="variable">-&gt;where</span>([<span class="string">'status'</span> =&gt; <span class="number">1</span>]);</div><div class="line"></div><div class="line"><span class="comment">// Or more explicitly using using `select`, which always returns a `Spot\Query` object</span></div><div class="line"><span class="variable">$posts</span> = <span class="variable">$mapper</span><span class="variable">-&gt;select</span>()<span class="variable">-&gt;where</span>([<span class="string">'status'</span> =&gt; <span class="number">1</span>]);</div></pre></figure>

<div class="callout info">
  A <code>Spot\Query</code> object is returned with all queries, which means additional
  conditions and other statements can be chained in any way or order you want.
  The query will be lazy-executed on interation or <code>count</code>, or manually by ending
  the chain with a call to <code>execute()</code>.
</div>

<h4 id="Conditional_Variations">Conditional Variations</h4>
<figure class="highlight php"><pre><div class="line"><span class="comment"># All posts with a 'published' status, descending by date_created</span></div><div class="line"><span class="variable">$posts</span> = <span class="variable">$mapper</span><span class="variable">-&gt;all</span>()</div><div class="line">    <span class="variable">-&gt;where</span>([<span class="string">'status'</span> =&gt; <span class="string">'published'</span>])</div><div class="line">    <span class="variable">-&gt;order</span>([<span class="string">'date_created'</span> =&gt; <span class="string">'DESC'</span>]);</div><div class="line"></div><div class="line"><span class="comment"># All posts created before 3 days ago</span></div><div class="line"><span class="variable">$posts</span> = <span class="variable">$mapper</span><span class="variable">-&gt;all</span>()</div><div class="line">    <span class="variable">-&gt;where</span>([<span class="string">'date_created &lt;'</span> =&gt; <span class="keyword">new</span> \DateTime(<span class="string">'-3 days'</span>)]);</div><div class="line"></div><div class="line"><span class="comment"># Posts with 'id' of 1, 2, 5, 12, or 15 - Array value = automatic "IN" clause</span></div><div class="line"><span class="variable">$posts</span> = <span class="variable">$mapper</span><span class="variable">-&gt;all</span>()</div><div class="line">    <span class="variable">-&gt;where</span>([<span class="string">'id'</span> =&gt; [<span class="number">1</span>, <span class="number">2</span>, <span class="number">5</span>, <span class="number">12</span>, <span class="number">15</span>]]);</div></pre></figure>

<h3 id="first([conditions])">first([conditions])</h3>
<p>Find and return a single <code>Spot\Entity</code> object that matches the criteria.</p>
<figure class="highlight php"><pre><div class="line"><span class="variable">$post</span> = <span class="variable">$mapper</span><span class="variable">-&gt;first</span>([<span class="string">'title'</span> =&gt; <span class="string">"Test Post"</span>]);</div></pre></figure>

<p>Or <code>first</code> can be used on a previous query with <code>where</code> to fetch only the first
matching record.</p>
<figure class="highlight php"><pre><div class="line"><span class="variable">$post</span> = <span class="variable">$mapper</span><span class="variable">-&gt;where</span>([<span class="string">'title'</span> =&gt; <span class="string">"Test Post"</span>])<span class="variable">-&gt;first</span>();</div></pre></figure>

<p>A call to <code>first</code> will always execute the query immediately, and return either
a single loaded entity object, or boolean <code>false</code>.</p>
<h3 id="select()">select()</h3>
<p>To get an instance of the query builder (<code>Spot\Query</code>) with no conditions set
on it, use <code>select</code>.</p>
<figure class="highlight php"><pre><div class="line"><span class="comment">// Get instance of the query builder directly</span></div><div class="line"><span class="variable">$query</span> = <span class="variable">$mapper</span><span class="variable">-&gt;select</span>();</div></pre></figure>

<p>This is effectively the same thing as <code>all()</code>, but without any semantics attached.</p>
</article></section></div></div></div><div class="container"><footer id="page_foot"><div class="row"><div class="col-md-8 col-lg-8"><p class="text-muted">Using Spot in an awesome project? <a href="http://twitter.com/vlucas">Let me know</a>!</p><p class="text-muted"><a href="https://github.com/vlucas/spot2"><i class="fa fa-github"></i> View Code on GitHub</a> &mdash; Open source under the <a href="http://www.opensource.org/licenses/bsd-license.php">BSD license</a>.</p></p></div><div class="col-md-4 col-lg-4"><p class="text-muted text-right">Website built with&nbsp;<a href="http://hexo.io/">hexo</a></p></div><script type="text/javascript">(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-359731-14', 'phpdatamapper.com');
ga('send', 'pageview');</script></div></footer></div></body></html>