<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="author" content="Vance Lucas"><meta name="keywords"><meta name="description"><title>Working With Mappers &ndash; Spot ORM</title><link href="/favicon.png" rel="icon"><link rel="alternate" href="/atom.xml" title="config.title" type="application/atom.xml"><link rel="stylesheet" href="/stylesheets/main.css"><link rel="stylesheet" href="/stylesheets/font-awesome.min.css"></head><body><nav id="topnav" role="navigation" class="navbar navbar-default"><div class="container"><a href="/" class="navbar-brand"><i class="fa fa-database"></i> Spot ORM</a><ul class="nav navbar-nav navbar-right pad-right"><li><a href="/">Home</a></li><li><a href="/docs">Documentation</a></li><li><a href="/articles">Articles</a></li></ul></div></nav><div class="container"><div class="row"><div class="col-md-2 col-lg-2"><div class="sidenav"><ul class="nav"><li><div class="nav-title">Setup</div><ul class="nav submenu"><li><a href="/docs/installation" title="Installation" class="link">Installation</a></li><li><a href="/docs/database-setup" title="Database Setup" class="link">Database Setup</a></li></ul></li><li><div class="nav-title">Basics</div><ul class="nav submenu"><li><a href="/docs/mappers" title="Mappers" class="link active">Mappers</a></li><li><a href="/docs/entities" title="Entities" class="link">Entities</a></li><li><a href="/docs/types" title="Field Types" class="link">Field Types</a></li><li><a href="/docs/migrations" title="Migrations" class="link">Migrations</a></li><li><a href="/docs/crud" title="Basic CRUD" class="link">Basic CRUD</a></li><li><a href="/docs/queries" title="Queries" class="link">Queries</a></li><li><a href="/docs/relations" title="Relations" class="link">Relations</a></li><li><a href="/docs/events" title="Events" class="link">Events</a></li></ul></li><li><div class="nav-title">Advanced</div><ul class="nav submenu"><li><a href="/docs/scopes" title="Scopes" class="link">Scopes</a></li><li><a href="/docs/complex-queries" title="Complex Queries" class="link">Complex Queries</a></li></ul></li></ul></div></div><div class="col-md-10 col-lg-10"><section id="page_content"><article><div class="toc-wrap"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Using_Custom_Mappers"><span class="toc-number">1.</span> <span class="toc-text">Using Custom Mappers</span></a></li></ol></div><h1>Working With Mappers<div class="docs-edit"><a href="https://github.com/vlucas/spot-site/blob/master/source/docs/mappers/index.md" title="Improve this Documentation"><i class="fa fa-pencil"></i> edit</a></div></h1><p>Since Spot follows the <a href="http://martinfowler.com/eaaCatalog/dataMapper.html" target="_blank" rel="external">DataMapper design
pattern</a>, you will need a
mapper instance for working with object Entities and database tables. You can
get a mapper instance from the <code>Spot\Locator</code> objectâ€™s <code>mapper</code> method by
providing the fully qualified entity namespace + class name:</p>
<figure class="highlight php"><pre><div class="line"><span class="variable">$postMapper</span> = <span class="variable">$spot</span><span class="variable">-&gt;mapper</span>(<span class="string">'Entity\Post'</span>);</div></pre></figure>

<p>Mappers only work with one entity type, so you will need one mapper per entity
class you work with (i.e. to save an Entity\Post, you will need the appropriate
mapper, and to save an Entity\Comment, you will need a comment mapper, not the
same post mapper. Relations will automatically be loaded and handled by their
corresponding mapper by Spot.</p>
<div class="callout info">
  <strong>You do NOT have to create a mapper for each entity</strong> unless you need
  custom finder methods or other custom logic. If there is no entity-specific
  mapper for the entity you want, Spot will load the generic mapper for you and
  return it.
</div>

<h2 id="Using_Custom_Mappers">Using Custom Mappers</h2>
<p>Although you do not have to create a mapper for each entity, sometimes it is
nice to create one if you have a lot of custom finder methods, or want a better
place to contain the logic of building all the queries you need.</p>
<p>Just specify the full mapper class name in your entity:</p>
<figure class="highlight php"><pre><div class="line"><span class="keyword">namespace</span> <span class="title">Entity</span>;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Post</span> <span class="keyword">extends</span> \<span class="title">Spot</span>\<span class="title">Entity</span></span></div><div class="line">{</div><div class="line">    <span class="keyword">protected</span> <span class="keyword">static</span> <span class="variable">$mapper</span> = <span class="string">'Entity\Mapper\Post'</span>;</div><div class="line"></div><div class="line">    <span class="comment">// ... snip ...</span></div><div class="line">}</div></pre></figure>

<p>And then create your mapper:</p>
<figure class="highlight php"><pre><div class="line"><span class="keyword">namespace</span> <span class="title">Entity</span>\<span class="title">Mapper</span>;</div><div class="line"></div><div class="line"><span class="keyword">use</span> <span class="title">Spot</span>\<span class="title">Mapper</span>;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">Post</span> <span class="keyword">extends</span> <span class="title">Mapper</span></span></div><div class="line">{</div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Get 10 most recent posts for display on the sidebar</div><div class="line">     *</div><div class="line">     *<span class="phpdoc"> @return</span> \Spot\Query</div><div class="line">     */</div><div class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">mostRecentPostsForSidebar</span><span class="params">()</span></span></div><div class="line">    {</div><div class="line">        <span class="keyword">return</span> <span class="variable">$this</span><span class="variable">-&gt;where</span>([<span class="string">'status'</span> =&gt; <span class="string">'active'</span>])</div><div class="line">            <span class="variable">-&gt;order</span>([<span class="string">'date_created'</span> =&gt; <span class="string">'DESC'</span>])</div><div class="line">            <span class="variable">-&gt;limit</span>(<span class="number">10</span>);</div><div class="line">    }</div><div class="line">}</div></pre></figure>

<p>Then when you load the mapper like normal, Spot will see the custom
<code>Entity\Post::$mapper</code> you defined, and load that instead of the generic one,
allowing you to call your custom method:</p>
<figure class="highlight php"><pre><div class="line"><span class="variable">$mapper</span> = <span class="variable">$spot</span><span class="variable">-&gt;mapper</span>(<span class="string">'Entity\Post'</span>);</div><div class="line"><span class="variable">$sidebarPosts</span> = <span class="variable">$mapper</span><span class="variable">-&gt;mostRecentPostsForSidebar</span>();</div></pre></figure>

</article></section></div></div></div><div class="container"><footer id="page_foot"><div class="row"><div class="col-md-8 col-lg-8"><p class="text-muted">Using Spot in an awesome project? <a href="http://twitter.com/vlucas">Let me know</a>!</p><p class="text-muted"><a href="https://github.com/vlucas/spot2"><i class="fa fa-github"></i> View Code on GitHub</a> &mdash; Open source under the <a href="http://www.opensource.org/licenses/bsd-license.php">BSD license</a>.</p></p></div><div class="col-md-4 col-lg-4"><p class="text-muted text-right">Website built with&nbsp;<a href="http://hexo.io/">hexo</a></p></div><script type="text/javascript">(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-359731-14', 'phpdatamapper.com');
ga('send', 'pageview');</script></div></footer></div></body></html>