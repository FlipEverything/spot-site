<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="author" content="Vance Lucas"><meta name="description"><title>Basic CRUD Operations&mdash;Spot ORM</title><link href="/favicon.png" rel="icon"><link rel="alternate" href="/atom.xml" title="config.title" type="application/atom.xml"><link rel="stylesheet" href="/stylesheets/main.css"><link rel="stylesheet" href="/stylesheets/font-awesome.min.css"></head><body><nav id="topnav" role="navigation" class="navbar navbar-default"><div class="container"><a href="/" class="navbar-brand"><i class="fa fa-database"></i> Spot ORM</a><ul class="nav navbar-nav navbar-right pad-right"><li><a href="/">Home</a></li><li><a href="/docs">Documentation</a></li><li><a href="/articles">Articles</a></li></ul></div></nav><div class="container"><div class="row"><div class="col-md-2 col-lg-2"><div class="sidenav"><ul class="nav"><li><div class="nav-title">Setup</div><ul class="nav submenu"><li><a href="/docs/installation" title="Installation" class="link">Installation</a></li><li><a href="/docs/database-setup" title="Database Setup" class="link">Database Setup</a></li></ul></li><li><div class="nav-title">Basics</div><ul class="nav submenu"><li><a href="/docs/mappers" title="Mappers" class="link">Mappers</a></li><li><a href="/docs/entities" title="Entities" class="link">Entities</a></li><li><a href="/docs/types" title="Field Types" class="link">Field Types</a></li><li><a href="/docs/migrations" title="Migrations" class="link">Migrations</a></li><li><a href="/docs/crud" title="Basic CRUD" class="link active">Basic CRUD</a></li><li><a href="/docs/queries" title="Queries" class="link">Queries</a></li><li><a href="/docs/relations" title="Relations" class="link">Relations</a></li><li><a href="/docs/events" title="Events" class="link">Events</a></li></ul></li><li><div class="nav-title">Advanced</div><ul class="nav submenu"><li><a href="/docs/scopes" title="Scopes" class="link">Scopes</a></li><li><a href="/docs/complex-queries" title="Complex Queries" class="link">Complex Queries</a></li></ul></li></ul></div></div><div class="col-md-10 col-lg-10"><section id="page_content"><article><div class="toc-wrap"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#build([array_$data])"><span class="toc-number">1.</span> <span class="toc-text">build([array $data])</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#create([array_$data])"><span class="toc-number">2.</span> <span class="toc-text">create([array $data])</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#insert([$data])"><span class="toc-number">3.</span> <span class="toc-text">insert([$data])</span></a></li><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Data_Array"><span class="toc-number">3.1.</span> <span class="toc-text">Data Array</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Entity_Object"><span class="toc-number">3.2.</span> <span class="toc-text">Entity Object</span></a></li></ol><li class="toc-item toc-level-2"><a class="toc-link" href="#save($entity)"><span class="toc-number">4.</span> <span class="toc-text">save($entity)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#update($entity)"><span class="toc-number">5.</span> <span class="toc-text">update($entity)</span></a></li></ol></div><h1>Basic CRUD Operations<div class="docs-edit"><a href="https://github.com/vlucas/spot-site/blob/master/source/docs/crud/index.md" title="Improve this Documentation"><i class="fa fa-pencil"></i> edit</a></div></h1><p>There are four main save methods on Spot’s mapper: <code>insert</code>, <code>create</code>, <code>save</code>,
and <code>update</code>. There are some basic differences between them, so this page
will address each one.</p>
<h2 id="build([array_$data])">build([array $data])</h2>
<p>Build an entity object with the provided array data.</p>
<figure class="highlight php"><pre><span class="comment">// Returns a new loaded Entity\User object</span>
<span class="variable">$entity</span> = <span class="variable">$mapper</span>-&gt;build([
    <span class="string">'name'</span> =&gt; <span class="string">'Chester Tester'</span>,
    <span class="string">'email'</span> =&gt; <span class="string">'chester@example.com'</span>
]);
</pre></figure>
<strong>Build will create the Entity object for you, but it will not save it</strong>. If
you also wish to save the entity object, you must pass it to one of the save
methods:

<figure class="highlight php"><pre><span class="variable">$mapper</span>-&gt;save(<span class="variable">$entity</span>);
</pre></figure>

<h2 id="create([array_$data])">create([array $data])</h2>
<p>Create will both <strong>build</strong> and <strong>insert</strong> the entity. The result will be a
fully-loaded entity object that has already been saved.</p>
<figure class="highlight php"><pre><span class="comment">// Returns a successfully saved, loaded Entity\User object... or throws an exception</span>
<span class="variable">$entity</span> = <span class="variable">$mapper</span>-&gt;create([
    <span class="string">'name'</span> =&gt; <span class="string">'Chester Tester'</span>,
    <span class="string">'email'</span> =&gt; <span class="string">'chester@example.com'</span>
]);
</pre></figure>

<div class="callout info">
  <h4>Expect an Entity… or Else!</h4>
  Unlike <code>insert</code> and <code>save</code>, the <code>create</code> method <strong>will throw an exception if
  a record cannot be inserted</strong>. This is because since it only accepts a data
  array, a boolean false on failure would not allow the user to see any
  validation errors if present. So instead, the <code>create</code> method will always
  return either a successfully inserted Entity object, or will throw an
  exception. This makes the <code>create</code> method a great choice for database seed
  files and other setup scripts.
</div>

<h2 id="insert([$data])">insert([$data])</h2>
<p>The <code>insert</code> method will create a new row in the database with the provided
data (either an array of data, or a <code>Spot\Entity</code> object), and will return
either the inserted record’s primary key, or boolean false.</p>
<h3 id="Data_Array">Data Array</h3>
<p>Using a data array is perhaps the easiest way to use <code>insert</code>:</p>
<figure class="highlight php"><pre><span class="comment">// Insert and return record primary key, or boolean false</span>
<span class="variable">$result</span> = <span class="variable">$mapper</span>-&gt;insert([
    <span class="string">'name'</span> =&gt; <span class="string">'Chester Tester'</span>,
    <span class="string">'email'</span> =&gt; <span class="string">'chester@example.com'</span>
]);

<span class="comment">// Fetch inserted record by ID</span>
<span class="keyword">if</span> (<span class="variable">$result</span>) {
    <span class="variable">$entity</span> = <span class="variable">$mapper</span>-&gt;get(<span class="variable">$result</span>);
}
</pre></figure>

<h3 id="Entity_Object">Entity Object</h3>
<p>You can also pass a <code>Spot\Entity</code> object to <code>insert</code>:</p>
<figure class="highlight php"><pre><span class="comment">// Insert and return record primary key, or boolean false</span>

<span class="variable">$entity</span> = <span class="variable">$mapper</span>-&gt;build([
    <span class="string">'name'</span> =&gt; <span class="string">'Chester Tester'</span>,
    <span class="string">'email'</span> =&gt; <span class="string">'chester@example.com'</span>
]);
<span class="variable">$result</span> = <span class="variable">$mapper</span>-&gt;insert(<span class="variable">$entity</span>);

<span class="comment">// Fetch inserted record by ID</span>
<span class="keyword">if</span> (<span class="variable">$result</span>) {
    <span class="comment">// Do something with $entity</span>
}
</pre></figure>

<h2 id="save($entity)">save($entity)</h2>
<p>The <code>save</code> method is a convenience method that handles both inserting and
updating an entity object. Save will call either <code>insert</code> or <code>update</code>,
depending on whether the Entity has already been saved (it will check
<code>$entity-&gt;isNew()</code> internally).</p>
<figure class="highlight php"><pre><span class="comment">// Save and return record primary key, or boolean false</span>

<span class="variable">$entity</span> = <span class="variable">$mapper</span>-&gt;build([
    <span class="string">'name'</span> =&gt; <span class="string">'Chester Tester'</span>,
    <span class="string">'email'</span> =&gt; <span class="string">'chester@example.com'</span>
]);
<span class="variable">$result</span> = <span class="variable">$mapper</span>-&gt;save(<span class="variable">$entity</span>);

<span class="comment">// Fetch inserted record by ID</span>
<span class="keyword">if</span> (<span class="variable">$result</span>) {
    <span class="comment">// Update with another call to save</span>
    <span class="variable">$entity</span>-&gt;name = <span class="string">'Lester Tester'</span>;
    <span class="variable">$mapper</span>-&gt;save(<span class="variable">$entity</span>);
}
</pre></figure>

<h2 id="update($entity)">update($entity)</h2>
<p>The <code>update</code> method will update an existing entity.</p>
<figure class="highlight php"><pre><span class="comment">// Find and update an entity</span>
<span class="variable">$entity</span> = <span class="variable">$mapper</span>-&gt;first([<span class="string">'email'</span> =&gt; <span class="string">'chester@example.com'</span>]);
<span class="keyword">if</span> (<span class="variable">$entity</span>) {
    <span class="variable">$entity</span>-&gt;name = <span class="string">'Lester Tester'</span>;
    <span class="variable">$mapper</span>-&gt;update(<span class="variable">$entity</span>);
}
</pre></figure>
</article></section></div></div></div><div class="container"><footer id="page_foot"><div class="row"><div class="col-md-8 col-lg-8"><p class="text-muted">Using Spot in an awesome project? <a href="http://twitter.com/vlucas">Let me know</a>!</p><p class="text-muted"><a href="https://github.com/vlucas/spot2"><i class="fa fa-github"></i> View Code on GitHub</a> &mdash; Open source under the <a href="http://www.opensource.org/licenses/bsd-license.php">BSD license</a>.</p></p></div><div class="col-md-4 col-lg-4"><p class="text-muted text-right">Website built with&nbsp;<a href="http://hexo.io/">hexo</a></p></div><script type="text/javascript">(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-359731-14', 'phpdatamapper.com');
ga('send', 'pageview');</script></div></footer></div></body></html>